(function(){var t=[].indexOf||function(t){for(var s=0,e=this.length;s<e;s++)if(s in this&&this[s]===t)return s;return-1};module.exports=function(){function s(){var t,s,e,i,n,a;for(t=e=0,n=(a=this.posNames).length;e<n;t=++e)s=a[t],this.pos[s]=t;for(t=i=2;i<=9;t=++i)this.handVals[""+t]=t;this.state={bb:null,betting:null,bettingRound:0,chips:0,community:null,communitySuits:null,communityVals:null,faces:null,hand:null,monster:!1,pair:!1,playable:!1,pokerHand:null,pokerHandComm:null,pokerVals:null,pokerValsComm:null,pos:null,previousRound:null,round:null,suits:null,vals:[0,0]}}return s.prototype.handVals={T:10,J:11,Q:12,K:13,A:14},s.prototype.info={name:"johnMcClane",email:"",btcWallet:""}
,s.prototype.pokerHand={straightFlush:8,fourKind:7,fullHouse:6,flush:5,straight:4,threeKind:3,twoPair:2,pair:1,highCard:0},s.prototype.pokerHandNames=["high card","pair","two pair","three of a kind","straight","flush","full house","four of a kind","straight flush"],s.prototype.pos={},s.prototype.posNames=["button","sb","bb","utg","mp1","mp","hj","co"],s.prototype.preflopRanges=[["A8s+","KQ","KJ","QJ","22+"],["AQs","AK","77+"],["AQs","AK","77+"],["AQs","AK","77+"],["AJ+","55+"],["AJ+","KQs","22+"],["AJ+","KQ","QJ","22+"],["AJ+","KQ","QJ","22+"]],s.prototype.specialBet={fold:-1,checkFold:0},s.prototype.state=null,s.prototype.analyse=function(t){var s,e,i,n,a,o,r,l,h,u,p,f,c,d,m,y,g,k,v,b,H,V,A,K,N,C,B;if(i=t.betting,l=t.community,n=(K=t.self).cards,a=K.chips,d=K.position,c=t.players,y=t.state,this.state.betting=i,this.state.community=l.sort().join(""),this.state.communitySuits=function(){var t,s,e,i;for(i=[],t=0,s=(e=this.state.community.slice(1)).length;t<s;t+=2)g=e[t],i.push(g);return i}.call(this).sort().join(""),this.state.communityVals=function(){var t,s,e,i;for(i=[],t=0,s=(e=this.state.community).length;t<s;t+=2)v=e[t],i.push(this.handVals[v]);return i}.call(this),this.state.hand=p=n.sort().join(""),this.state.faces=u=p[0]+p[2],this.state.suits=p[1]+p[3],this.state.chips=a,this.state.vals=[this.handVals[u[0]],this.handVals[u[1]]],this.sortNum(this.state.vals),this.state.pos=h=this.calcPos(c.length,d),this.state.bb=this.getBigBlind(c),this.state.playable=!1,this.state.previousRound=this.state.round,this.state.round=y,this.state.previousRound===y?this.state.bettingRound++:this.state.bettingRound=1,this.state.pair=u[0]===u[1],"pre-flop"===y){for(this.state.monster="AA"===u||"KK"===u,B=[],b=0,V=(N=this.preflopRanges[h]).length;b<V;b++)if(m=N[b],this.inRange(m)){this.state.playable=!0;break}return B}if(s=this.state.suits.concat(this.state.communitySuits),e=this.state.vals.concat(this.state.communityVals),o=this.classifyHand(s,e),this.state.pokerHand=o.type,this.state.pokerVals=o.vals,r=this.classifyHand(this.state.communitySuits,this.state.communityVals),this.state.pokerHandComm=r.type,this.state.pokerValsComm=r.vals,(k=(k=this.state.pokerHand>=this.pokerHand.threeKind)&&this.state.pokerHand>=this.state.pokerHandComm)&&this.state.pokerHand===this.state.pokerHandComm)for(k=!1,f=H=0,A=(C=this.state.pokerVals).length;H<A;f=++H)if(C[f]>this.state.pokerValsComm[f]){k=!0;break}return this.state.playable=k,this.state.monster=k&&this.state.pokerHand>=this.pokerHand.fullHouse},s.prototype.calcPos=function(t,s){var e;return s++,s%=t,2===t&&1===s?this.pos.bb:s<4?s:(e=t-s-1)<2?[this.pos.co,this.pos.hj][e]:4===s?this.pos.mp1:this.pos.mp},s.prototype.classifyHand=function(t,s){var e,i,n,a,o,r,l,h,u,p,f,c,d,m,y,g,k,v,b,H,V;if(e=this.containsFlush(t),l=this.containsStraight(s),e&&l){if(c=!0,s.length>5){for(h={},n=d=0,g=s.length;d<g;n=++d)h[f=s[n]]=t[n];for(h[1]=h[14],f=m=l,v=l-5;l<=v?m<v:m>v;f=l<=v?++m:--m)if(h[f]!==e){c=!1;break}}if(c)return{type:this.pokerHand.straightFlush,vals:[l]}}if(null!=(i=null!=(b=(r=this.containsNofaKind(s)).countToVals)?b[4]:void 0))return{type:this.pokerHand.fourKind,vals:i};if(p=null!=(H=r.countToVals)?H[2]:void 0,u=null!=(V=r.countToVals)?V[3]:void 0,null!=p&&null!=u)return{type:this.pokerHand.fullHouse,vals:[this.maxArr(u),this.maxArr(p)]};if(null!=u&&(a=u.length)>1)return this.sortNum(u),{type:this.pokerHand.fullHouse,vals:[u[a-1],u[a-2]]};if(e){for(o=-1,n=y=0,k=s.length;y<k;n=++y)f=s[n],t[n]===e&&f>o&&(o=f);return{type:this.pokerHand.flush,vals:[o]}}if(l)return{type:this.pokerHand.straight,vals:[l]};if(null!=u)return{type:this.pokerHand.threeKind,vals:[this.maxArr(u)]};if(null!=p)return 1===(a=p.length)?{type:this.pokerHand.pair,vals:p}:(this.sortNum(p),{type:this.pokerHand.twoPair,vals:[p[a-1],p[a-2]]});if(!r)return{type:this.pokerHand.highCard,vals:[this.maxArr(s)]};throw new Error("Invalid ofKind state.")},s.prototype.containsFlush=function(t){var s,e,i,n,a,o;if(""===t)return!1;for(s={},n=0,a=t.length;n<a;n++)if(e=null!=(o=s[i=t[n]])?o:0,s[i]=++e,5===e)return i;return!1},s.prototype.containsNofaKind=function(t){var s,e,i,n,a,o,r,l,h;for(a=new Uint8Array(15),n=null,r=0,l=t.length;r<l;r++)(s=++a[o=t[r]])>1&&(null==n&&(n={valToCount:{},countToVals:{}}),n.valToCount[o]=s);if(null==n)return!1;for(o in h=n.valToCount)s=h[o],i=!1,o=parseInt(o,10),null==(e=n.countToVals[s])?n.countToVals[s]=e=[]:i=!0,e.push(o),i&&this.sortNum(e);return n},s.prototype.containsStraight=function(t){var s,e,i,n,a,o,r,l;if(t.length<5)return!1;for(n=0,o=t.length;n<o;n++)if((i=t[n])===this.handVals.A){t=t.concat(1);break}for(this.sortNum(t),s=1,e=t[0],a=0,r=(l=t.slice(1)).length;a<r;a++){if((i=l[a])===e+1?s++:i!==e&&(s=1),5===s)return i;e=i}return!1},s.prototype.getBigBlind=function(t){var s,e,i,n;for(e=0,i=0,n=t.length;i<n;i++)(s=t[i]).blind>e&&(e=s.blind);return e},s.prototype.inRange=function(s){var e,i,n,a,o,r,l;return n=(l=this.state).pair,o=l.suits,r=l.vals,(!(t.call(s.slice(2),"s")>=0)||!n&&o[0]===o[1])&&(i=function(){var t,e,i,n;for(n=[],t=0,e=(i=s.slice(0,2)).length;t<e;t++)a=i[t],n.push(this.handVals[a]);return n}.call(this),this.sortNum(i),s[0]===s[1]?(e=r[0])===r[1]&&e>=i[0]:r[0]>=i[0]&&r[1]>=i[1])},s.prototype.maxArr=function(t){return Math.max.apply(null,t)},s.prototype.preflopBet=function(){return this.state.monster?this.state.chips:this.state.playable?1===this.state.bettingRound?8*this.state.betting.raise:this.state.betting.call:this.specialBet.checkFold},s.prototype.postflopBet=function(){return this.state.playable?this.state.monster?this.state.chips:1===this.state.bettingRound?8*this.state.betting.raise:this.state.betting.call:this.specialBet.checkFold},s.prototype.sortNum=function(t){return t.sort(function(t,s){return t-s})},s.prototype.update=function(t){switch(this.analyse(t),this.state.round){case"complete":return null;case"pre-flop":return this.preflopBet();default:return this.postflopBet()}},s}()}).call(this);
